// This file contains material supporting section 3.7 of the textbook:// "Object Oriented Software Engineering" and is issued under the open-source// license found at www.lloseng.com package client;import ocsf.client.*;import common.*;import java.io.*;/** * This class overrides some of the methods defined in the abstract superclass * in order to give more functionality to the client. * * @author Dr Timothy C. Lethbridge * @author Dr Robert Lagani&egrave; * @author Fran&ccedil;ois B&eacute;langer * @version July 2000 */public class ChatClient extends AbstractClient {	// Instance variables **********************************************	/**	 * The interface type variable. It allows the implementation of the display	 * method in the client.	 */	ChatIF clientUI;	// Constructors ****************************************************	/**	 * Constructs an instance of the chat client.	 *	 * @param host     The server to connect to.	 * @param port     The port number to connect on.	 * @param clientUI The interface type variable.	 */	public ChatClient(String host, int port, ChatIF clientUI) throws IOException {		super(host, port); // Call the superclass constructor		this.clientUI = clientUI;		openConnection();	}	// Instance methods ************************************************	/**	 * This method handles all data that comes in from the server.	 *	 * @param msg The message from the server.	 */	public void handleMessageFromServer(Object msg) {		clientUI.display(msg.toString());	}	/**	 * This method handles all data coming from the UI	 *	 * @param message The message from the UI.	 */	public void handleMessageFromClientUI(String message) {		if (isACommand(message)) {			// Deletes the "#" from the string before handling it			handleCommand(message.substring(1));		} else {			try {				sendToServer(message);			} catch (IOException e) {				clientUI.display("Could not send message to server (not connected)");				logoff();			}		}	}	/**	 * This method terminates the client.	 */	public void quit() {		try {			closeConnection();		} catch (IOException e) {		}		System.exit(0);	}	protected void connectionClosed() {		clientUI.display("Connection closed");	}	protected void connectionException(Exception exception) {		clientUI.display("Server stopped");		logoff();	}	protected void connectionEstablished() {		clientUI.display("Connection Established");	}	// Commands methods ************************************************	/**	 * Returns true if the msg is a command	 * 	 * @param msg	 * @return	 */	public boolean isACommand(String msg) {		return msg.charAt(0) == '#';	}	/**	 * Handle the commands	 * 	 * @param cmd The command string without "#"	 */	public void handleCommand(String cmd) {		String[] s = cmd.split(" ");		if (s[0].equals("quit")) {			quit();		} else if (s[0].equals("logoff")) {			logoff();		} else if (s[0].equals("sethost")) {			this.setHost(s[1]);		} else if (s[0].equals("setport")) {			try {				this.setPort(Integer.parseInt(s[1]));			} catch (NumberFormatException e) {				this.clientUI.display("Not an integer !");			}		} else if (s[0].equals("login")) {			login();		} else if (s[0].equals("gethost")) {			clientUI.display(getHost());					} else if (s[0].equals("getport")) {			clientUI.display(Integer.valueOf(getPort()).toString());		} else {			clientUI.display("This command doesn't exists");		}	}	/**	 * Log the client in and display a message if it is already connected	 */	public void login() {		if (isConnected()) {			clientUI.display("You are already logged in");		} else {			try {				openConnection();			} catch (IOException e) {				clientUI.display("Could not connect to server : the host or port may be invalid");			}		}	}	/**	 * Log the client out and display a message if it is already disconnected	 */	public void logoff()  {		if (!isConnected()) {			clientUI.display("You are already logged off");		} else {			try {				sendToServer("#logoff");				closeConnection();			} catch (IOException e) {			}		}	}}//End of ChatClient class